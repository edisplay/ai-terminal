<div class="split-container" [ngClass]="{'resizing-active': isResizing}">
  <!-- Left Panel - Terminal -->
  <div class="panel terminal-panel" [style.width.px]="leftPanelWidth" [ngClass]="{'full-width': !isAIPanelVisible}">
    <div class="panel-content">
      <!-- Terminal Tabs -->
      <div class="terminal-tabs">
        <div class="tabs-container">
          <app-terminal-tab
            *ngFor="let session of terminalSessions; trackBy: trackBySessionId"
            [session]="session"
            [canClose]="terminalSessions.length > 1"
            (select)="switchToSession($event)"
            (close)="closeSession($event)"
          ></app-terminal-tab>
          <button class="new-tab" (click)="createNewSession(undefined, true)" title="New tab">
            +
          </button>
        </div>
      </div>

      <div class="output-area terminal-output-area">
        <div class="xterm-wrapper" #terminalContainer></div>
      </div>
    </div>
  </div>

  <!-- Resizer - Only show when AI panel is visible -->
  <div class="resizer" (mousedown)="startResize($event)" (touchstart)="startResize($event)"
    [class.resizing]="isResizing" *ngIf="isAIPanelVisible">
  </div>

  <!-- Right Panel - AI Chat - Only show when isAIPanelVisible is true -->
  <div class="panel ai-panel" *ngIf="isAIPanelVisible">
    <div class="panel-content">
      <div class="output-area">
        <div class="chat-history">
          <div *ngFor="let entry of chatHistory; trackBy: trackByChatEntry" class="chat-entry">
            <!-- Add question display -->
            <div class="chat-question">
              <span class="message"><b>{{ entry.message }}</b></span>
            </div>
            <div class="chat-output">
              <ng-container *ngFor="let segment of entry.response.split('\n'); trackBy: trackByResponseSegment">
                <!-- Check if segment is a code block placeholder -->
                <ng-container *ngIf="isCodeBlockPlaceholder(segment) && entry.codeBlocks">
                  <!-- Get the index of the code block -->
                  <ng-container *ngIf="getCodeBlockIndex(segment) >= 0">
                    <!-- Simple command display -->
                    <div class="command-block">
                      <div class="command-content">
                        <span class="simple-command">
                          <span class="command-text">
                            {{ transformCodeForDisplay(entry.codeBlocks[getCodeBlockIndex(segment)].code) }}
                          </span>
                          <span class="command-actions">
                            <button class="command-action-button" data-tooltip="Copy"
                              (click)="copyCodeBlock(entry.codeBlocks[getCodeBlockIndex(segment)].code)">
                              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                              </svg>
                            </button>
                            <button class="command-action-button" data-tooltip="Copy to terminal"
                              (click)="sendCodeToTerminal(entry.codeBlocks[getCodeBlockIndex(segment)].code)">
                              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="9 10 4 15 9 20"></polyline>
                                <path d="M20 4v7a4 4 0 0 1-4 4H4"></path>
                              </svg>
                            </button>
                            <button class="command-action-button" data-tooltip="Execute"
                              (click)="executeCodeDirectly(entry.codeBlocks[getCodeBlockIndex(segment)].code)">
                              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polygon points="5 3 19 12 5 21 5 3"></polygon>
                              </svg>
                            </button>
                          </span>
                        </span>
                        <span class="command-explanation"
                          *ngIf="getCommandExplanation(entry.codeBlocks[getCodeBlockIndex(segment)].code)">
                          {{ getCommandExplanation(entry.codeBlocks[getCodeBlockIndex(segment)].code) }}
                        </span>
                      </div>
                    </div>
                  </ng-container>
                </ng-container>

                <!-- Regular text lines -->
                <div *ngIf="!isCodeBlockPlaceholder(segment)" [innerHTML]="sanitizeHtml(segment)"></div>
              </ng-container>
            </div>
          </div>
        </div>
      </div>
      <div class="input-area">
        <div class="prompt-container">
          <textarea [(ngModel)]="currentQuestion" (keydown)="askAI($event)" (input)="autoResize($event)"
            [disabled]="isProcessingAI" placeholder="Ask AI or type /help, /models, /model..." autofocus spellcheck="false"></textarea>
        </div>
      </div>
    </div>
  </div>
</div>